# PasarGuard Admin Report ๐

ุงู ูพุฑูฺู ฺฉ ุงุณฺฉุฑูพุช ฺฏุฒุงุฑุดโฺฏุฑ ุญุฑููโุง ุจุฑุง **PasarGuard / Marzban Panel** ุงุณุช ฺฉู ฺฏุฒุงุฑุดโูุง **ุฑูุฒุงูู / ููุชฺฏ / ูุงูุงูู** ุฑุง ุงุฒ ุฏุชุงุจุณ ุฎูุงูุฏู ู ุจู ุชูฺฏุฑุงู ุงุฑุณุงู ูโฺฉูุฏ.

โ ูุฏู ุงุตู ุงู ูพุฑูฺู: **ุฌููฺฏุฑ ุงุฒ ุถุฑุฑ ูุงู**  
โ ฺูู ูุฑ ุงฺฉุงูุช ุฌุฏุฏุ ุงูุฒุงุด ุญุฌูุ ุฑุณุช ูุตุฑู ู ูุงูุญุฏูุฏ ุดุฏู ุญุฌู ุฏุฑ ฺฏุฒุงุฑุดโูุง ุซุจุช ูโุดูุฏ.

---

## โจ ุงูฺฉุงูุงุช ุงุตู

### โ ฺฏุฒุงุฑุด ุฑูุฒุงูู (Daily)
ุจุฑุง ูุฑ ุงุฏูู ุจู ุตูุฑุช ุฌุฏุงฺฏุงูู ุงุฑุณุงู ูโุดูุฏ:

- ุณุงุฎุช ฺฉุงุฑุจุฑ ุฌุฏุฏ (`INSERT`) โ ูุญุงุณุจู ฺฉู ุญุฌู ุณุงุฎุชู ุดุฏู
- ุงูุฒุงุด ุญุฌู ฺฉุงุฑุจุฑ (`CHANGE_LIMIT`) โ ููุท ุงุฎุชูุงู ุญุฌู ุฌุฏุฏ ู ูุจู (ุงฺฏุฑ ูุซุจุช ุจุงุดุฏ)
- ุฑุณุช ูุตุฑู (`RESET_USAGE`) โ ูุญุงุณุจู ฺฉู ุญุฌู ูพูู (ฺูู ุฏูุจุงุฑู ุญุฌู ฺฉุงูู ุฏุงุฏู ุดุฏู)
- ูุงูุญุฏูุฏ ุดุฏู ุญุฌู (`UNLIMITED`) โ ููุงุด `unlimited`
- ุงูุฒุงุด ุฒูุงู (`CHANGE_EXPIRE`) โ ููุท ููุงุด `extend` (ุญุฌู ูุฏุงุฑุฏ)

---

### โ ฺฏุฒุงุฑุด ููุชฺฏ (Weekly)
- ุจุงุฒู: **ุดูุจู ุชุง ุฌูุนู**
- ฺฉ ูพุงู ฺฉู ุจุฑุง ููู ุงุฏููโูุง
- ุนูุงูู ุจุฑ ุญุฌูุ ุชุนุฏุงุฏ ู ูุณุช ฺฉุงุฑุจุฑุงู `unlimited` ูู ููุงุด ุฏุงุฏู ูโุดูุฏ

---

### โ ฺฏุฒุงุฑุด ูุงูุงูู (Monthly)
- ุจุงุฒู: **ูุงู ุดูุณ ูุจู**
- ุฏุฑ ุฑูุฒ ุงูู ูุฑ ูุงู ุดูุณ ุงุฌุฑุง ูโุดูุฏ
- ุญุฌู ูุฑ ุงุฏูู + ุชุนุฏุงุฏ/ูุณุช unlimited ูุง ูุดุฎุต ุงุณุช

---

## โ ููุงูู ูุญุงุณุจู ุฏูู (ุถุฏ ุถุฑุฑ ูุงู)

| Action ุฏุฑ ุฏุชุงุจุณ | ูุนู | ูุญุงุณุจู ูุงู |
|------------------|------|-------------|
| INSERT | ุณุงุฎุช ฺฉุงุฑุจุฑ ุฌุฏุฏ | ฺฉู `data_limit_new` |
| CHANGE_LIMIT | ุงูุฒุงุด/ุชุบุฑ ุญุฌู | ููุท `new - old` ุงฺฏุฑ ูุซุจุช ุจุงุดุฏ |
| RESET_USAGE | ุฑุณุช ูุตุฑู | ฺฉู `data_limit_new` |
| UNLIMITED | ูุงูุญุฏูุฏ ุดุฏู ุญุฌู | ููุท ููุงุด `unlimited` |
| CHANGE_EXPIRE | ุงูุฒุงุด ุฒูุงู | ููุท ููุงุด `extend` |
| UPDATE | ุขูพุฏุช ุณุณุชู | ูุงุฏุฏู ฺฏุฑูุชู ูโุดูุฏ |
| DELETE | ุญุฐู ฺฉุงุฑุจุฑ | ูุงุฏุฏู ฺฏุฑูุชู ูโุดูุฏ |

โ Unlimited ุญุฌู ุนู: `data_limit_new == 0` ุง `NULL`  
โ๏ธ Unlimited ุฒูุงู (expire) ุงููุช ูุฏุงุฑุฏ.

---

## ๐ ููููู ุฎุฑูุฌ

### โ ฺฏุฒุงุฑุด ุฑูุฒุงูู
```text
Daily report - 1404-10-06
Admin: admin58586

- ali: +50.00 GB
- reza2022: unlimited
- m12: +20.00 GB | reset

Total: 70.00 GB

Unlimited users:
reza2022

---

### โ ฺฏุฒุงุฑุด ููุชฺฏ (Weekly)

- ุจุงุฒู: **ุดูุจู ุชุง ุฌูุนู**
- ุจุฑุง ููู ุงุฏููโูุง ุฏุฑ ฺฉ ูพุงู ุงุฑุณุงู ูโุดูุฏ
- ุนูุงูู ุจุฑ ุญุฌูุ ุชุนุฏุงุฏ ฺฉุงุฑุจุฑุงู `unlimited` ู ูุณุช ุขูโูุง ูุฒ ููุงุด ุฏุงุฏู ูโุดูุฏ

---

### โ ฺฏุฒุงุฑุด ูุงูุงูู (Monthly)

- ุจุงุฒู: **ูุงู ุดูุณ ูุจู**
- ุฏุฑ ุฑูุฒ ุงูู ูุฑ ูุงู ุดูุณ ุงุฌุฑุง ูโุดูุฏ
- ุญุฌู ฺฉู ูุฑ ุงุฏูู + ุชุนุฏุงุฏ ู ูุณุช unlimited ูุง ููุงุด ุฏุงุฏู ูโุดูุฏ

---

## ๐ ูุตุจ ุณุฑุน (ูพุดููุงุฏ)

โ ููุท 3 ุฏุณุชูุฑ:

```bash
git clone https://github.com/<YOUR_USERNAME>/pasarguard-admin-report.git
cd pasarguard-admin-report
sudo bash install.sh
โ ูุตุจ ฺู ฺฉุงุฑูุง ุงูุฌุงู ูโุฏูุฏุ
ุงุณฺฉุฑูพุช ูุตุจ (install.sh) ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ:

โ ูพฺฉุฌโูุง ููุฑุฏ ูุงุฒ ุฑุง ูุตุจ ูโฺฉูุฏ (python3, pip, cron, mysql-client)
โ ูุงูโูุง ุฑุง ุฏุงุฎู ูุณุฑ /opt/pasarguard-admin-report ฺฉูพ ูโฺฉูุฏ
โ ุชูุธูุงุช ุฑุง ุงุฒ ุดูุง ูโูพุฑุณุฏ (DB + Telegram + timezone)
โ ุฎูุฏุด ูุงู .env ูโุณุงุฒุฏ
โ Virtualenv ู requirements ุฑุง ูุตุจ ูโฺฉูุฏ
โ ุงุชุตุงู MySQL ุฑุง ุชุณุช ูโฺฉูุฏ
โ ุฏุฑ ุตูุฑุช ูุงุฒ triggers ุฑุง ูุตุจ ูโฺฉูุฏ
โ Cronjob ุฑูุฒุงูู/ููุชฺฏ/ูุงูุงูู ุฑุง ุงุฌุงุฏ ูโฺฉูุฏ
โ ุฏุฑ ูพุงุงู ุชุณุช ุฑูุฒุงูู ุฑุง ุงุฌุฑุง ูโฺฉูุฏ (ุงุฎุชุงุฑ)

๐ง ูุตุจ Trigger ูุง (ุฎู ููู)
ุจุฑุง ุงูฺฉู ฺฏุฒุงุฑุดโูุง ุฏูู ุจุงุดูุฏ ู ุชูุงู ุชุบุฑุงุช ุซุจุช ุดูุฏุ ุฏุชุงุจุณ ุจุงุฏ users_logs ุฑุง ฺฉุงูู ูพุฑ ฺฉูุฏ.

โ ูุงู triggers.sql ููุฑุงู ูพุฑูฺู ูุฌูุฏ ุฏุงุฑุฏ.
ุงฺฏุฑ ูุตุจโฺฉููุฏู ุชุงุฒูโฺฉุงุฑ ุจุงุดุฏุ install.sh ุฎูุฏุด ูโูพุฑุณุฏ:

Install triggers.sql ? (y/n)

ุงฺฏุฑ y ุจุฒูุฏ triggers ูุตุจ ูโุดููุฏ.

โ ูุตุจ ุฏุณุช Trigger:

bash
Copy code
mysql -u root -p -h 127.0.0.1 -D pasarguard < triggers.sql
โฐ Cron Jobs (ุฎูุฏฺฉุงุฑ ูุตุจ ูโุดูุฏ)
ุงู ฺฉุฑููโูุง ุชูุณุท installer ุงุถุงูู ูโุดููุฏ:

cron
Copy code
# Daily report (ูุฑ ุฑูุฒ ุณุงุนุช 00:05)
5 0 * * * /opt/pasarguard-admin-report/.venv/bin/python /opt/pasarguard-admin-report/pasarguard_admin_report.py >> /var/log/pasarguard_admin_report.log 2>&1

# Weekly report (ูุฑ ุดูุจู ุณุงุนุช 00:10)
10 0 * * 6 /opt/pasarguard-admin-report/.venv/bin/python /opt/pasarguard-admin-report/pasarguard_admin_report.py weekly >> /var/log/pasarguard_weekly.log 2>&1

# Monthly report (ุงูู ูุฑ ูุงู ุณุงุนุช 00:15)
15 0 1 * * /opt/pasarguard-admin-report/.venv/bin/python /opt/pasarguard-admin-report/pasarguard_admin_report.py monthly >> /var/log/pasarguard_monthly.log 2>&1
โ ุงุฌุฑุง ุฏุณุช (ุจุฑุง ุชุณุช)
bash
Copy code
cd /opt/pasarguard-admin-report
source .venv/bin/activate

python pasarguard_admin_report.py
python pasarguard_admin_report.py weekly
python pasarguard_admin_report.py monthly
๐งพ ูุณุฑ ูุงฺฏโูุง
ฺฏุฒุงุฑุด ุฑูุฒุงูู:
/var/log/pasarguard_admin_report.log

ฺฏุฒุงุฑุด ููุชฺฏ:
/var/log/pasarguard_weekly.log

ฺฏุฒุงุฑุด ูุงูุงูู:
/var/log/pasarguard_monthly.log

โ ุฑูุน ุฎุทุงูุง ุฑุงุฌ
โ ุฎุทุง ุงุชุตุงู MySQL (Connection refused)
โ ุนู ุฏุชุงุจุณ ุฑู ุงู ุณุฑูุฑ ูุตุจ ูุณุช ุง ูพูุฑุช ุจุณุชู ุงุณุช.

ุจุฑุฑุณ:

bash
Copy code
ss -tulnp | grep 3306
ุงฺฏุฑ ฺุฒ ูุงูุฏ ุนู MySQL ุงุฌุฑุง ูุณุช ุง ุฑู ุณุฑูุฑ ุฏฺฏุฑ ุงุณุช.

ุฏุฑ ุงู ุญุงูุช ุจุงุฏ MYSQL_HOST ุฑุง IP ุตุญุญ ุจุฒูุฏ (ุณุฑูุฑ ุฏุชุงุจุณ).

โ๏ธ ุฏุฑ ฺฏุฒุงุฑุด Unlimited ููุงุด ุฏุงุฏู ููโุดูุฏ
โ ุนู Trigger ูุตุจ ูุดุฏู ุง ุฏุฑุณุช ฺฉุงุฑ ููโฺฉูุฏ.

ูุตุจ ุฏุณุช Trigger:

bash
Copy code
mysql -u root -p -h 127.0.0.1 -D pasarguard < triggers.sql
