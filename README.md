# PasarGuard Admin Report ๐

**PasarGuard Admin Report** ฺฉ ุงุณฺฉุฑูพุช ฺฏุฒุงุฑุดโฺฏุฑ ุฏูู ู ุถุฏ ุถุฑุฑ ูุงู ุจุฑุง **PasarGuard / Marzban Panel** ุงุณุช ฺฉู ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ฺฏุฒุงุฑุดโูุง **ุฑูุฒุงูู / ููุชฺฏ / ูุงูุงูู** ุฑุง ุงุฒ ุฏุชุงุจุณ ุฏุฑุงูุช ูโฺฉูุฏ ู ุฏุฑ **ุชูฺฏุฑุงู** ุงุฑุณุงู ูโฺฉูุฏ.

โ ูุฏู ุงุตู: **ุฌููฺฏุฑ ุงุฒ ุถุฑุฑ ูุงู**  
โ ฺูู ูุฑฺฏููู ุณุงุฎุช ุงฺฉุงูุช ุฌุฏุฏุ ุงูุฒุงุด ุญุฌูุ ุฑุณุช ูุตุฑูุ ู ูุงูุญุฏูุฏ ฺฉุฑุฏู ุญุฌู (Unlimited) ุฏุฑ ฺฏุฒุงุฑุดโูุง ูุดุฎุต ูโุดูุฏ.

---

## โจ ุงูฺฉุงูุงุช ุงุตู

### โ ฺฏุฒุงุฑุด ุฑูุฒุงูู (Daily)
ุจุฑุง ูุฑ ุงุฏูู ุจูโุตูุฑุช ุฌุฏุงฺฏุงูู ุงุฑุณุงู ูโุดูุฏ ู ุดุงูู ููุงุฑุฏ ุฒุฑ ุงุณุช:

- ุณุงุฎุช ฺฉุงุฑุจุฑ ุฌุฏุฏ (`INSERT`) โ ูุญุงุณุจู ฺฉุงูู ุญุฌู ุณุงุฎุชู ุดุฏู
- ุงูุฒุงุด ุญุฌู ฺฉุงุฑุจุฑ (`CHANGE_LIMIT`) โ ูุญุงุณุจู ููุท ุงุฎุชูุงู ุญุฌู ุฌุฏุฏ ู ูุจู (ููุท ุงฺฏุฑ ูุซุจุช ุจุงุดุฏ)
- ุฑุณุช ูุตุฑู (`RESET_USAGE`) โ ูุญุงุณุจู ฺฉุงูู ุญุฌู ูพูู (ฺูู ฺฉุงุฑุจุฑ ุฏูุจุงุฑู ุญุฌู ฺฉุงูู ฺฏุฑูุชู)
- ูุงูุญุฏูุฏ ฺฉุฑุฏู ุญุฌู (`UNLIMITED`) โ ููุงุด ุจูโุตูุฑุช `unlimited`
- ุงูุฒุงุด ุฒูุงู (`CHANGE_EXPIRE`) โ ููุท ููุงุด `extend` (ูฺ ูุฒูู ุญุฌู ูุฏุงุฑุฏ)
- `UPDATE` ู `DELETE` โ ูุญุงุณุจู ููโุดููุฏ

---

### โ ฺฏุฒุงุฑุด ููุชฺฏ (Weekly)
- ุจุงุฒู ุฒูุงู: **ุดูุจู ุชุง ุฌูุนู**
- ุจุฑุง ููู ุงุฏููโูุง ุฏุฑ ฺฉ ูพุงู ุงุฑุณุงู ูโุดูุฏ
- ุนูุงูู ุจุฑ ุญุฌู ูุตุฑูุ ุชุนุฏุงุฏ ฺฉุงุฑุจุฑุงู `unlimited` ู ูุณุช ุขูโูุง ูุฒ ููุงุด ุฏุงุฏู ูโุดูุฏ

---

### โ ฺฏุฒุงุฑุด ูุงูุงูู (Monthly)
- ุจุงุฒู ุฒูุงู: **ูุงู ุดูุณ ูุจู**
- ุฏุฑ ุฑูุฒ ุงูู ูุฑ ูุงู ุดูุณ ุงุฌุฑุง ูโุดูุฏ
- ุญุฌู ฺฉู ูุฑ ุงุฏูู + unlimitedโูุง ููุงุด ุฏุงุฏู ูโุดูุฏ

---

## โ ููุงูู ูุญุงุณุจู ุฏูู (ุถุฏ ุถุฑุฑ ูุงู)

ุงุณฺฉุฑูพุช ููุท ููุงุฑุฏ ุฑุง ูุญุงุณุจู ูโฺฉูุฏ ฺฉู **ุงุซุฑ ูุงู** ุฏุงุฑูุฏ.

| Action ุฏุฑ ุฏุชุงุจุณ | ูุนู | ูุญุงุณุจู ูุงู |
|------------------|------|-------------|
| INSERT | ุณุงุฎุช ฺฉุงุฑุจุฑ ุฌุฏุฏ | ฺฉู `data_limit_new` |
| CHANGE_LIMIT | ุงูุฒุงุด/ุชุบุฑ ุญุฌู | ููุท `new - old` ุงฺฏุฑ ูุซุจุช ุจุงุดุฏ |
| RESET_USAGE | ุฑุณุช ูุตุฑู | ฺฉู `data_limit_new` |
| UNLIMITED | ูุงูุญุฏูุฏ ุดุฏู ุญุฌู | ููุท ููุงุด `unlimited` |
| CHANGE_EXPIRE | ุงูุฒุงุด ุฒูุงู | ููุท ููุงุด `extend` |
| UPDATE | ุขูพุฏุช ุณุณุชู | ูุงุฏุฏู ฺฏุฑูุชู ูโุดูุฏ |
| DELETE | ุญุฐู ฺฉุงุฑุจุฑ | ูุงุฏุฏู ฺฏุฑูุชู ูโุดูุฏ |

โ Unlimited ุญุฌู ุนู `data_limit_new = 0` ุง `NULL` ุจุงุดุฏ  
โ๏ธ Unlimited ุฒูุงู (expire) ููู ูุณุช

---

## ๐ ููููู ุฎุฑูุฌ (Example Output)

### โ ฺฏุฒุงุฑุด ุฑูุฒุงูู
```text
Daily report - 1404-10-06
Admin: admin58586

- ali: +50.00 GB
- reza2022: unlimited
- m12: +20.00 GB | reset
- userx: extend

Total: 70.00 GB

Unlimited users:
reza2022





ูุตุจ ุณุฑุน (ูพุดููุงุฏ)

โ ููุท ุจุง ณ ุฏุณุชูุฑ ูุตุจ ู ุขูุงุฏู ุงุณุชูุงุฏู ูโุดูุฏ:

git clone https://github.com/lastdejavu/pasarguard-admin-report.git
cd pasarguard-admin-report
sudo bash install.sh




โ ูุตุจโฺฉููุฏู ุญุฑููโุง (install.sh) ฺู ฺฉุงุฑ ูโฺฉูุฏุ

ุงุณฺฉุฑูพุช install.sh ุงู ฺฉุงุฑูุง ุฑุง ุงูุฌุงู ูโุฏูุฏ:

โ ูุตุจ ูพฺฉุฌโูุง ุถุฑูุฑ ุณุณุชู (python, pip, venv, cron, mysql-client)
โ ฺฉูพ ูพุฑูฺู ุฏุฑ ูุณุฑ ุงุณุชุงูุฏุงุฑุฏ /opt/pasarguard-admin-report
โ ุงุฌุงุฏ Virtualenv ู ูุตุจ ูุงุจุณุชฺฏโูุง ุงุฒ requirements.txt
โ ุงุฌุฑุง Wizard ุชูุธูุงุช ู ุณุงุฎุช ุฎูุฏฺฉุงุฑ ูุงู .env
โ ูุตุจ Cron Job ูุง ุฑูุฒุงูู / ููุชฺฏ / ูุงูุงูู
โ (ุงุฎุชุงุฑ) ูุตุจ ุชุฑฺฏุฑูุง ุฏุชุงุจุณ (triggers.sql)
โ ุงูฺฉุงู ุงุฌุฑุง ุชุณุช ุจุนุฏ ุงุฒ ูุตุจ

โ๏ธ ุชูุธูุงุช (Configuration)

ุฏุฑ ุฒูุงู ูุตุจุ wizard ุงู ุงุทูุงุนุงุช ุฑุง ุงุฒ ุดูุง ูโูพุฑุณุฏ:

MySQL Host / Port / User / Password / Database

Telegram Bot Token

Telegram Chat ID

Timezone (ูพุดูุฑุถ: Asia/Tehran)

โ ุชูุงู ุงู ุงุทูุงุนุงุช ุฏุฑ ูุงู .env ุฐุฎุฑู ูโุดูุฏ.

โฐ Cron Jobs (ุฒูุงูโุจูุฏ ุฎูุฏฺฉุงุฑ)

ุจุนุฏ ุงุฒ ูุตุจุ ุงู cron job ูุง ุงุถุงูู ูโุดูุฏ:

โ Daily โ ูุฑ ุฑูุฒ ุณุงุนุช 00:05
โ Weekly โ ูุฑ ุดูุจู ุณุงุนุช 00:10
โ Monthly โ ุฑูุฒ ฑ ูุฑ ูุงู ุณุงุนุช 00:15

ุงฺฏุฑ ุฎูุงุณุชุฏ ุจุจูุฏ cron ูุง ุซุจุช ุดุฏู ุง ูู:

crontab -l

โ Trigger ูุง ุฏุชุงุจุณ (ุจุณุงุฑ ููู)

๐ ุงฺฏุฑ ุณุณุชู ุดูุง ุจู ุทูุฑ ูพุดูุฑุถ ุฏุงุฎู ุฏุชุงุจุณ users_logs ุฑุง ูพุฑ ููโฺฉูุฏุ ุงู ูพุฑูฺู ูุงุฒ ุฏุงุฑุฏ ฺฉู ุชุฑฺฏุฑูุง ูุตุจ ุจุงุดูุฏ ุชุง ูุฑ ุชุบุฑ ฺฉุงุฑุจุฑ ุซุจุช ุดูุฏ.

โ ูุงู ุขูุงุฏู ุฏุฑ ูพุฑูฺู ูุฌูุฏ ุฏุงุฑุฏ:

๐ triggers.sql

ูุตุจ Trigger ูุง (ุฏุณุช)
mysql -u root -p -h 127.0.0.1 -D pasarguard < triggers.sql


โ ุง ููฺฏุงู ูุตุจุ installer ุงุฒ ุดูุง ูโูพุฑุณุฏ ู ุฎูุฏุด ูุตุจ ูโฺฉูุฏ.

๐งช ุงุฌุฑุง ุฏุณุช ุจุฑุง ุชุณุช

ุจุนุฏ ุงุฒ ูุตุจ:

cd /opt/pasarguard-admin-report
source .venv/bin/activate

python pasarguard_admin_report.py
python pasarguard_admin_report.py weekly
python pasarguard_admin_report.py monthly

๐ ูุณุฑ ูุงฺฏโูุง

ฺฏุฒุงุฑุด ุฑูุฒุงูู: /var/log/pasarguard_admin_report.log

ฺฏุฒุงุฑุด ููุชฺฏ: /var/log/pasarguard_weekly.log

ฺฏุฒุงุฑุด ูุงูุงูู: /var/log/pasarguard_monthly.log

โ ุฑูุน ุฎุทุงูุง ุฑุงุฌ
โ ุฎุทุง Can't connect to MySQL (Connection refused)

โ ุนู ุฏุชุงุจุณ ุฑู ุงู ุณุฑูุฑ ุจุงูุง ูุณุช ุง ูพูุฑุช ุงุดุชุจุงู ุงุณุช.

ุจุฑุฑุณ ฺฉูุฏ MySQL ุฑู ุณุฑูุฑ ุงุฌุฑุง ูโุดูุฏ:

ss -tulnp | grep 3306


ุงฺฏุฑ ุฎุฑูุฌ ูุฏุงุฏ ุนู MySQL ูุตุจ/ูุนุงู ูุณุช ุง ุฑู ูพูุฑุช ุฏฺฏุฑ ุงุณุช.

โ Unlimited ุฏุฑ ฺฏุฒุงุฑุด ููโุขุฏ

โ ุนูุช นนูช ุงู ุงุณุช ฺฉู Trigger ูุง ูุตุจ ูุณุชูุฏ ุง users_logs ูพุฑ ููโุดูุฏ.

โ Trigger ูุง ุฑุง ูุตุจ ฺฉูุฏ:

mysql -u root -p -h 127.0.0.1 -D pasarguard < triggers.sql

โ License

MIT License

ุงฺฏุฑ ุงู ูพุฑูฺู ุจุฑุง ุดูุง ููุฏ ุจูุฏ โญ Star ฺฉูุฏ ๐
